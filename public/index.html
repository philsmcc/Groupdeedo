<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Groupdeedo - Local Chat</title>
    <meta name="description" content="Anonymous location-based group chat">
    <meta name="theme-color" content="#4A90E2">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Groupdeedo">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí¨</text></svg>">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <!-- Terms of Service Modal -->
    <div id="tosModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Welcome to Groupdeedo</h2>
            </div>
            <div class="modal-body">
                <p>üìç <strong>Location-based anonymous chat</strong></p>
                <p>By using Groupdeedo, you agree to:</p>
                <ul>
                    <li>Be respectful and kind to others</li>
                    <li>Not share personal information</li>
                    <li>Not post illegal or harmful content</li>
                    <li>Allow location access for the app to work</li>
                </ul>
                <p><small>Your location is only used to show you nearby messages and is not stored permanently.</small></p>
            </div>
            <div class="modal-footer">
                <button id="agreeTos" class="btn btn-primary">I Agree & Continue</button>
            </div>
        </div>
    </div>
    
    <!-- Main App Container -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <img src="/groupdeedo-logo.png" alt="Groupdeedo" class="header-logo">
                </h1>
                <button id="settingsBtn" class="settings-btn" title="Settings">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Connection Status -->
            <div id="connectionStatus" class="connection-status">
                <span class="status-indicator"></span>
                <span class="status-text">Connecting...</span>
            </div>
        </header>
        
        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel">
            <div class="settings-content">
                <div class="settings-header">
                    <h3>Settings</h3>
                    <button id="closeSettings" class="close-btn">‚úï</button>
                </div>
                
                <div class="setting-group">
                    <label for="displayName">Posting as:</label>
                    <input type="text" id="displayName" placeholder="Anonymous" maxlength="20">
                </div>
                
                <div class="setting-group">
                    <label for="radiusSlider">Radius: <span id="radiusValue">5</span> miles</label>
                    <input type="range" id="radiusSlider" min="1" max="500" value="5" class="slider">
                    <div class="slider-labels">
                        <span>1 mi</span>
                        <span>500 mi</span>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label for="channelName">Channel (optional):</label>
                    <div class="channel-input-group">
                        <input type="text" id="channelName" placeholder="Leave empty for public chat" maxlength="50">
                        <button id="shareChannel" class="btn btn-small" style="display: none;">Share</button>
                    </div>
                    <div class="channel-help">
                        <small>Private channels are for sharing with friends. Public channel shows everyone nearby.</small>
                    </div>
                </div>
                
                <div class="setting-group">
                    <div class="location-status">
                        <span id="locationStatus">üìç Getting location...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Chat Messages Container -->
        <main class="chat-container">
            <div id="messagesContainer" class="messages">
                <div class="welcome-message">
                    <p>üéâ Welcome to Groupdeedo!</p>
                    <p>You'll see messages from people near you.</p>
                    <p>Tap the gear icon ‚öôÔ∏è to customize your settings.</p>
                </div>
            </div>
        </main>
        
        <!-- Message Input -->
        <footer class="message-input-container">
            <div class="input-group">
                <button id="imageBtn" class="image-btn" title="Add image">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21,15 16,10 5,21"></polyline>
                    </svg>
                </button>
                
                <div class="message-input-wrapper">
                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    <div id="imagePreview" class="image-preview" style="display: none;">
                        <img id="previewImg" src="" alt="Preview">
                        <button id="removeImage" class="remove-image">‚úï</button>
                    </div>
                    <textarea 
                        id="messageInput" 
                        placeholder="Type a message..." 
                        rows="1"
                        maxlength="500"
                    ></textarea>
                </div>
                
                <button id="sendBtn" class="send-btn" disabled title="Send message">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                    </svg>
                </button>
            </div>
        </footer>
    </div>
    
    <!-- Channel Share Modal -->
    <div id="shareModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Share Channel</h3>
                <button id="closeShareModal" class="close-btn">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="share-content">
                    <div class="qr-container">
                        <div id="qrCode"></div>
                    </div>
                    <div class="share-options">
                        <div class="share-url">
                            <input type="text" id="shareUrl" readonly>
                            <button id="copyUrl" class="btn btn-small">Copy</button>
                        </div>
                        <p><small>Share this QR code or link with friends to join your private channel.</small></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Loading Groupdeedo...</p>
    </div>
    
    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- QR Code library (local copy to avoid CORS issues) -->
    <script src="/qrcode.min.js"></script>
    <script src="/app.js"></script>
</body>
</html>